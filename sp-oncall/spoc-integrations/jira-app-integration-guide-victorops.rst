Jira App integration for Splunk On-Call
**********************************************************

Requirements
================

* Jira Version Required: Jira Server 7.7.0 - 8.22.6, Jira Cloud
* Splunk On-Call Version Required: Starter, Growth, or Enterprise
* Global Admin privileges are required for the Splunk On-Call configuration.

Configure in Splunk On-Call
=====================================

#. In Splunk On-Call, go to :guilabel:`Integrations` then :guilabel:`API`.
#. Select :guilabel:`New Key`. 
#. Give the key a description and copy the resulting API key and API ID.

Install the Splunk On-Call Add-On in Jira
==========================================

#. Log in as a Jira administrator, then select the Jira administration gear icon then select :guilabel:`Manage apps` to go to the Atlassian Marketplace.
#. In the sidebar, select :guilabel:`Find new apps` under the Atlassian Marketplace header.
#. If you are on Jira Server, search for the app "Splunk On-Call for Jira Server". If you are on Jira Cloud, search for "VictorOps for Jira Cloud". After you've located the right app, select :guilabel:`Install`.
#. After installation completes, select :guilabel:`Configure`.

Configuring application settings
--------------------------------

#. Enter the API key you generated in VictorOps in the :guilabel:`API Key` field under :guilabel:`Connect to your VictorOps Organization` on the VictorOps for Jira Server Configuration page.
#. In the :guilabel:`API ID` field in the same section, insert the API ID you coped in the preceding Configure Splunk On-Call step.
#. Copy the Splunk On-Call org ID displayed in your VictorOps URL. The org ID is at the end of the URL you use to log in: ``https://portal.victorops.com/client/<Org_ID>``. Paste the org ID in Jira's :guilabel:`Organization ID` field.
#. Select :guilabel:`Connect`.

A new entry appears in the Connected VictorOps Organizations section with a green VALID flag.

.. image:: /_images/spoc/1jira.png

Configure Jira project settings
-------------------------------------

The Splunk On-Call add-on must be activated and configured for each Jira project you want to associate. While multiple projects can
connect to the same Splunk On-Call organization, projects cannot share the same Default Team Escalation Policy.

#. In Jira, select :guilabel:`Projects`.
#. Go to :guilabel:`Project settings` of the project you want to activate for the Splunk On-Call add-on.
#. Select :guilabel:`VictorOps Settings`.
#. Select :guilabel:`Enable VictorOps for this Project`.

The page displays a list of configurable fields.

Default incident settings
~~~~~~~~~~~~~~~~~~~~~~~~~

#. Under :guilabel:`VictorOps Instance`, select the Splunk On-Call organization you want to associate with this project.
#. Under :guilabel:`Default Team Escalation Policy`, select the Splunk On-Call Escalation Policy you want to page when Jira issues create incidents in Splunk On-Call. Incoming VictorOps incidents assigned to this Escalation Policy are the only incidents allowed to create issues in your Jira project.
#. Under :guilabel:`Default User`, select the Jira user you want to designate as reporter for issues generated by incoming Splunk On-Call incidents.

Incoming issue settings
~~~~~~~~~~~~~~~~~~~~~~~

Splunk On-Call incidents created for a project's Default Team Escalation Policy automatically generate Jira issues. The default type for such issues (Bug, Epic, Story, or Task) is set by selecting the desired option from the :guilabel:`Issue type to use for incoming VictorOps incidents` dropdown menu.

If you want to disable such issue creation, deselect the :guilabel:`Allow issues to be created from incidents via the REST API` checkbox.

.. image:: /_images/spoc/2jira.png
   :width: 50%

Jira state configuration
~~~~~~~~~~~~~~~~~~~~~~~~

Define state mapping to allows Jira issues to remain synchronized as incidents move through their life cycle in VictorOps.

.. image:: /_images/spoc/3jira.png
   :alt: 
   :width: 50%

Create a Splunk On-Call incident in Jira
--------------------------------------------------

Splunk On-Call incidents can only be created from the Jira issue view.

#. Select :guilabel:`More` then :guilabel:`Create VictorOps Incident`. 
#. A preview of the Splunk On-Call incident card displays using the project's Default Team Escalation Policy. 
#. (Optional) Select a different escalation policy from the :guilabel:`VictorOps Team Escalation Policy` dropdown menu. 
#. (Optional) Use the :guilabel:`Additional Users` dropdown menu to include additional users for response. Adding users to an incident does not create a multi-responder incident in Splunk On-Call.
#. Select :guilabel:`Create Incident` to generate a Splunk On-Call incident. A triggered Splunk On-Call incident card displays under the VictorOps section in the issue view.
#. Select the :guilabel:`Incident Details` in the incident card in Splunk On-Call to display the incident in a new browser tab.

.. image:: /_images/spoc/4jira.png
   :alt: 